#### 服务化拆分

* 纵向拆分，从业务维度进行拆分。比如web端作为一个模块，用户端作为一个模块，等等

* 横向拆分：从公共并且独立的维度进行拆分。标准时按照公共被多个其他服务调用，并且依赖的资源独立不予其他业务耦合。

  > 比如，社交App的昵称，无论是在首页信息，评论还是消息箱，都需要显示用户昵称，如果有新的需求开发完成，那么所有模块都要进行发布。如果昵称作为独立的模块发布就不会影响其他模块。
  >
  > 但是无论怎么样都会出现耦合。

![1584338357124](markdownImage/1584338357124.png)

#### 微服务框架主要依赖的几个基本组件(6个)

- 服务描述：理解为接口文档？

- 注册中心：服务提供者将服务登记在注册中心。

  > 一般的流程：
  >
  > ​	服务提供者在启动的时候：根据服务发布文件中配置的发布信息向注册中心注册自己的服务。
  >
  > ​	服务消费者在启动的时候：根据消费者配置文件中配置的服务信息向注册中心订阅自己所需要的的服务。注册中心会返回服务提供者地址列表给消费者。
  >
  > ![1584338875044](markdownImage/1584338875044.png)

- 服务框架： 在注册中心获取地址准备调用之前。整个框架的基础内容：

  ①：服务通信是什么协议？四层tcp、udp？ 七层 http？other？

  ②：数据传输采用的方式？ 同步？异步？单连接传输？ 多路复用？

  ③：数据压缩采用的格式？ JSON序列？ java对象序列化？Protobuf序列化？

- 服务监控：就是在正常服务后，对整个框架下的服务进行监控，查看服务是否正常。

  ①：指标收集--把每次服务调用的请求耗时，成功与否等信息上传到数据处理中心。

  ②：数据处理--根据①的数据，计算每秒服务请求量、平均耗时、成功率等指标

  ③：数据展示--展示①、②的数据

- 服务追踪：方便查询故障。每次服务请求后，都会记录服务每一次调用经过的那些链路，方便后续的问题追踪，和故障定位

  > 服务消费者在发起调用前，会在本地按照一定的规则生成一个requestid，发起调用时，将requestuid作为请求参数的部分，传递给服务提供者。
  >
  > 服务器提供者接受到请求后，记录这次的请求的requestid，然后处理请求。如果服务提供者继续请求其他服务，也会在本地生成自己的requestID，然后把这两个requestid当做参数继续往下传递。

- 服务治理：主要是解决各种问题。自动摘除故障节点，自动切换IDC、熔断、限流

#### 如何发布和引用服务

​	服务发布和引用有三种：

- RESTful api
- XML配置
- LDL文件

